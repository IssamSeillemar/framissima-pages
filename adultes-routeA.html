<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Programme d'animation – FRAMISSIMA</title>
  <style>
    :root{
      --fram-red:#E32219; /* rouge FRAMISSIMA */
      --fram-gray:#706F6F;
      --border:#E6E6E6;
      --radius:16px;
      --text:#000; --bg:#fff;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:12px 14px 56px}

    /* Header PNG (toujours présent en route A) */
    .club-header{
      position:sticky; top:0; z-index:50;
      background:#fff; border-bottom:1px solid var(--border);
      padding:8px 14px 10px;
    }
    .club-header img{display:block;max-width:100%;height:auto;border-radius:10px}

    /* Topbar (titre + burger) */
    .topbar{
      position:sticky; top:0; z-index:40;
      background:#fff; border-bottom:1px solid var(--border);
    }
    .topbar__inner{
      position:relative;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px;
    }
    .title{margin:0;font-size:28px;font-weight:800}

    /* Bandeau application (plein écran) */
    .club-banner{width:100%; overflow:hidden; background:#fff; border-bottom:1px solid var(--border)}
    .club-banner img{display:block; width:100%; height:auto}

    /* Burger */
    .burger{
      display:inline-flex; flex-direction:column; gap:4px;
      width:34px; height:28px; align-items:flex-end;
      background:transparent; border:0; cursor:pointer; padding:0; margin:0;
    }
    .burger span{display:block;height:3px;background:var(--fram-red);border-radius:3px}
    .burger span:nth-child(1){width:100%}
    .burger span:nth-child(2){width:70%}
    .burger span:nth-child(3){width:85%}

    /* Menu flottant (10vw) */
    .menu{
      position:absolute; top:100%; right:14px;
      width:10vw;
      background:#fff; border:1px solid var(--border);
      border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.08);
      padding:12px; display:flex; flex-direction:column; gap:10px;
      transform:translateY(-10px); opacity:0; pointer-events:none;
      transition:transform .25s ease, opacity .25s ease;
    }
    .menu.open{transform:translateY(0); opacity:1; pointer-events:auto}
    .btn-nav{
      display:block; width:100%;
      text-align:center; text-decoration:none;
      background:var(--fram-red); color:#fff; font-weight:700;
      padding:12px 14px; border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,.06);
    }
    @media (max-width:400px){ .menu{ width:100vw; right:0 } }

    /* Timeline */
    .timeline{display:flex; gap:10px; overflow:auto hidden; padding:12px 2px; margin:8px -2px}
    .chip{
      flex:0 0 auto; min-width:110px; border:1px solid var(--border);
      border-radius:999px; background:#fff; padding:12px 14px;
      display:flex; flex-direction:column; align-items:center; gap:2px
    }
    .chip small{font-size:12px; color:var(--fram-gray); text-transform:capitalize}
    .chip strong{font-size:14px}
    .chip.active{box-shadow:inset 0 -2px 0 0 var(--fram-red)}

    /* Programme du jour */
    .dayTitle{margin:10px 0 14px; font-size:24px; font-weight:800}
    .list{display:flex; flex-direction:column; gap:10px}
    .card{display:flex; gap:12px; border:1px solid var(--border); border-radius:var(--radius); padding:14px; background:#fff}
    .time{flex:0 0 90px; border-right:1px dashed var(--border); padding-right:12px; text-align:right}
    .time b{font-size:18px}
    .place{font-size:13px; color:var(--fram-gray)}
    .titleEvt{font-weight:800}
    .empty{border:1px dashed var(--border); border-radius:var(--radius); padding:22px; text-align:center; color:var(--fram-gray)}
    .fine-note{margin:22px 0 0; font-size:12px; color:var(--fram-gray); display:none}
  </style>
</head>
<body>
  <!-- Header PNG -->
  <header id="clubHeader" class="club-header"></header>

  <!-- Barre de titre + menu -->
  <header class="topbar">
    <div class="topbar__inner wrap">
      <h1 class="title">Programme d'animation</h1>
      <button id="burger" class="burger" aria-expanded="false" aria-controls="menu" aria-label="Ouvrir le menu">
        <span></span><span></span><span></span>
      </button>
      <nav id="menu" class="menu" aria-hidden="true">
        <a class="btn-nav" id="btnInfos"  href="#">Infos hôtel</a>
        <a class="btn-nav" id="btnKids"   href="#">Club Enfants</a>
        <a class="btn-nav" id="btnTeens"  href="#">Club Ados</a>
      </nav>
    </div>
  </header>

  <!-- Bandeau application (sous la topbar) -->
  <div class="club-banner"><img id="bandeauAppAdultes" alt="Bandeau application adultes"></div>

  <main class="wrap">
    <nav id="timeline" class="timeline" aria-label="Semaine"></nav>
    <h2 id="dayTitle" class="dayTitle">Aujourd'hui</h2>
    <section id="list" class="list" aria-label="Programme"></section>
    <p id="fineNote" class="fine-note">Ce programme peut être modifié en fonction de la météo ou du nombre de participants aux activités.</p>
  </main>

  <!-- Variables injectées depuis Make -->
  <script>
    window.__PROGRAM__ = {
      club: "{{1.clubName}}",
      header: "{{55.header_b64}}",
      bandeauAdultes: "{{55.bandeauAdultes_b64}}",
      data: {{if(length(1.jsonLong) > 0; 1.jsonLong; "{}")}},
      slug: "{{1.slug}}"
    };
  </script>

<script>
/* ====== Utilitaires dates ====== */
const TZ = 'Europe/Paris';
const toISO = (d)=> new Intl.DateTimeFormat('en-CA',{timeZone:TZ,year:'numeric',month:'2-digit',day:'2-digit'}).format(d);
const fmtDay = new Intl.DateTimeFormat('fr-FR', { weekday:'long', day:'numeric', month:'long' });
const fmtChipDay = new Intl.DateTimeFormat('fr-FR', { weekday:'short' });
const fmtChipDate = new Intl.DateTimeFormat('fr-FR', { day:'2-digit', month:'short' });

const PROGRAM = window.__PROGRAM__;

/* ====== Header image (toujours présent) ====== */
const headerEl = document.getElementById('clubHeader');
const headerImg = new Image();
headerImg.src = PROGRAM.header.startsWith('data:') ? PROGRAM.header : `data:image/png;base64,${PROGRAM.header}`;
headerImg.alt = PROGRAM.club || 'FRAMISSIMA';
headerEl.appendChild(headerImg);

/* ====== Bandeau application (JPEG base64 ou data:) ====== */
(function(){
  try{
    const el = document.getElementById('bandeauAppAdultes');
    const src = (PROGRAM.bandeauAdultes||'').trim();
    if(src){
      el.src = src.startsWith('data:') ? src : `data:image/jpeg;base64,${src}`;
    }else{
      // si pas de bandeau fourni, on masque le conteneur pour éviter un espace vide
      el.parentElement.style.display = 'none';
    }
  }catch(e){}
})();

/* ====== Timeline ====== */
const timeline = document.getElementById('timeline');
const list = document.getElementById('list');
const dayTitle = document.getElementById('dayTitle');
const fineNote = document.getElementById('fineNote');

const days = [...Array(7)].map((_,i)=>{ const d=new Date(); d.setDate(d.getDate()+i); return d; });
let selected = location.hash.slice(1) || toISO(new Date());

function renderTimeline(){
  timeline.innerHTML='';
  days.forEach(d=>{
    const iso = toISO(d);
    const btn = document.createElement('button');
    btn.type='button';
    btn.className='chip'+(iso===selected?' active':'');
    btn.innerHTML = `<small>${fmtChipDay.format(d)}</small><strong>${fmtChipDate.format(d)}</strong>`;
    btn.addEventListener('click',()=>{
      selected=iso; location.hash=iso; renderDay(); renderTimeline();
    });
    timeline.appendChild(btn);
  });
}

/* ====== Rendu du jour ====== */
function renderDay(){
  const events = (PROGRAM.data?.[selected]||[]).slice().sort((a,b)=> (a.time||'').localeCompare(b.time||''));
  dayTitle.textContent = fmtDay.format(new Date(selected));
  list.innerHTML='';
  if(!events.length){
    const empty = document.createElement('div');
    empty.className='empty';
    empty.textContent = "Le programme de cette journée n'a pas été posté.";
    list.appendChild(empty);
    fineNote.style.display = 'none';
    return;
  }
  fineNote.style.display = 'block';
  for(const ev of events){
    const card = document.createElement('article');
    card.className='card';
    card.innerHTML = `
      <div class="time"><b>${ev.time||''}</b></div>
      <div class="meta">
        <div class="titleEvt">${ev.title||''}</div>
        ${ev.place? `<div class="place">${ev.place}</div>`:''}
      </div>`;
    list.appendChild(card);
  }
}
renderTimeline(); renderDay();

/* ====== Menu flottant (10vw) ====== */
const burger = document.getElementById('burger');
const menu = document.getElementById('menu');

function openMenu(){
  menu.classList.add('open');
  burger.setAttribute('aria-expanded','true');
  menu.setAttribute('aria-hidden','false');
}
function closeMenu(){
  menu.classList.remove('open');
  burger.setAttribute('aria-expanded','false');
  menu.setAttribute('aria-hidden','true');
}
burger.addEventListener('click', (e)=>{
  e.stopPropagation();
  menu.classList.contains('open') ? closeMenu() : openMenu();
});
menu.addEventListener('click', (e)=>{
  if(e.target.closest('a')) closeMenu();
});
document.addEventListener('click', (e)=>{
  if(menu.classList.contains('open') && !e.target.closest('#menu') && !e.target.closest('#burger')){
    closeMenu();
  }
});

/* ====== Liens inter-sites (même slug) ====== */
(function(){
  try{
    const slug = PROGRAM.slug || (location.pathname.split('/').filter(Boolean).slice(-1)[0] || '');
    document.getElementById('btnInfos').href = `https://infos-framissima.netlify.app/${slug}/`;
    document.getElementById('btnKids').href  = `https://club-enfants-framissima.netlify.app/${slug}/`;
    document.getElementById('btnTeens').href = `https://club-ados-framissima.netlify.app/${slug}/`;
  }catch(e){}
})();
</script>
</body>
</html>